<!DOCTYPE html>

<html lang="zh-CN" class="mingBackground mingBased">



<head>
    
    <meta charset="utf-8">

    
    
    
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta name="author" content="MingMoe & Thanks Octopress">

    
    <title>
é€šè¿‡ç¼–ç¨‹é…ç½®log4j2
- MingMoeçš„ç½‘ç»œåšå®¢
    </title>

    
    


<link type="text/css" rel="stylesheet" href="https://blog.kawayi.moe/css/normalize.css">




<link type="text/css" rel="stylesheet" href="https://blog.kawayi.moe/scss/ming.css">


<link type="text/css" rel="stylesheet" href="https://blog.kawayi.moe/css/syntax.css">



<style>    

    
    .mingBackground{
        background: url(/Background.webp);
    }

    
    .mingBased{
        font-size: 16px;
    }

</style>





<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Pacifico&display=swap" rel="stylesheet">

</head>



<body class="mingBody">

    
    
<header class="mingFacade">
    <h1>
        æ¬¢è¿æ¥åˆ°å¤§æ˜é…±çš„ç½‘ç»œåšå®¢ğŸ“š
    </h1>

    <p>
        ä¸€ä¸ªæŠ€æœ¯å®…çš„ç½‘ç»œåšå®¢â”—|ï½€Oâ€²|â”› ~~
    </p>
</header>

    
    

<nav class="mingNav">
    
    <ul>
        
        <li>
            <a href="https://blog.kawayi.moe/">Blog</a>
        </li>

        
        <li>
            <a href="https://blog.kawayi.moe/about">About Me</a>
        </li>

        
        <li>
            <a href="https://blog.kawayi.moe/archives">Archives</a>
        </li>

        
        <li>
            <a href="https://blog.kawayi.moe/categories">Categories</a>
        </li>

        
        <li>
            <a href="https://blog.kawayi.moe/tags">Tags</a>
        </li>

    </ul>

</nav>



<nav class="mingMenu">
    
    <select onchange="location = this.value;">
        
        <option>Navigate</option>
        
        <option value="https://blog.kawayi.moe/">ğŸ”— Blog</option>
        <option value="https://blog.kawayi.moe/about">ğŸ”— About Me</option>
        <option value="https://blog.kawayi.moe/archives">ğŸ”— Archives</option>
        <option value="https://blog.kawayi.moe/categories">ğŸ”— Categories</option>
        <option value="https://blog.kawayi.moe/tags">ğŸ”— Tags</option>
    </select>

</nav>

    
    
    <div class="mingContentWrapper">
        
        <main class="mingContent">
            


<div class="mingPostStyle">
    
    <div class="postHeader">
        
        <p></span> Saturday, November 6, 2021 </span><span> | <a href="/tags/log4j2">log4j2</a></span><span> | <a href="/tags/java">java</a></span></p>
    </div>

    
    <div class="postTitle">
        <h1>é€šè¿‡ç¼–ç¨‹é…ç½®log4j2</h1>
    </div>

    
    <div class="postContent">
        <p>æœ€è¿‘åœ¨ä½¿ç”¨Log4j2çš„æ—¶å€™ï¼Œç¢°åˆ°äº†ä¸€äº›é—®é¢˜ï¼šæ— è®ºæ˜¯ä½¿ç”¨<code>Configurator.initialize</code>è¿˜æ˜¯<code>LogManager.getContext().reconfigure()</code>éƒ½æ— æ³•å®Œå…¨æ›´æ–°log4j2çš„é…ç½®ã€‚</p>
<p>åœ¨æŸ¥çœ‹äº†Log4j2çš„æºä»£ç è¿‡åï¼Œç¬”è€…æ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆã€‚</p>
<p>tl;dr.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Configurator</span><span class="o">.</span><span class="na">initialize</span><span class="o">(</span>
    <span class="n">ClassLoader</span><span class="o">.</span><span class="na">getSystemClassLoader</span><span class="o">(),</span>
    <span class="n">configuration</span>
<span class="o">);</span>

<span class="n">Configurator</span><span class="o">.</span><span class="na">initialize</span><span class="o">(</span>
    <span class="n">configuration</span>
<span class="o">);</span>
<span class="c1">// ç¼ºä¸€ä¸å¯
</span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœè§‚å¯Ÿ<code>LogManager.getLogger(Class&lt;?&gt;)</code>ï¼Œä¼šå‘ç°å…¶è°ƒç”¨çš„æ˜¯<code>getContext(cls.getClassLoader(), false).getLogger(cls);</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="nf">getLogger</span><span class="o">(</span><span class="kd">final</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="n">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cls</span> <span class="o">=</span> <span class="n">callerClass</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
    <span class="c1">// note this:     â†“
</span><span class="c1"></span>    <span class="k">return</span> <span class="n">getContext</span><span class="o">(</span><span class="n">cls</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">(),</span> <span class="kc">false</span><span class="o">).</span><span class="na">getLogger</span><span class="o">(</span><span class="n">cls</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>å¯¹æ¯”ä¹‹ä¸‹çš„<code>LogManager.getLogger(String)</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="nf">getLogger</span><span class="o">(</span><span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// note this:         â†“
</span><span class="c1"></span>        <span class="k">return</span> <span class="n">name</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">getContext</span><span class="o">(</span><span class="kc">false</span><span class="o">).</span><span class="na">getLogger</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">:</span> <span class="n">getLogger</span><span class="o">(</span><span class="n">StackLocatorUtil</span><span class="o">.</span><span class="na">getCallerClass</span><span class="o">(</span><span class="n">2</span><span class="o">));</span>
    <span class="o">}</span>
</code></pre></td></tr></table>
</div>
</div><p>å¦‚æœä½¿ç”¨<code>LogManager.getLogger(String)</code>è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆloaderå°†ä¼šæ˜¯null(å¯¹æ¯”ä¹‹ä¸‹ï¼Œ<code>LogManager.getLogger(Class&lt;?&gt;)</code>ä½¿ç”¨<code>cls.getClassLoader()</code>è·å–äº†loader)ã€‚å¯èƒ½ä¼šæœ‰ä¸€æ¡å¯ç–‘çš„è­¦å‘Šä¿¡æ¯:
<code>WARNING: sun.reflect.Reflection.getCallerClass is not supported. This will impact performance.</code>
å¹¶ä¸”ä¼šè·å–åˆ°ä¸å¸¦æœ‰loaderå‚æ•°ä¸åŒçš„<code>LoggerContext</code>ã€‚</p>
<p><code>getLogger(Class&lt;?&gt;)</code>è™½ç„¶ä¸€ç›´ä½œä¸ºlog4j2çš„å…¸å‹ç”¨æ³•ï¼Œä»ç„¶æœ‰ä¸€äº›ç¬¬ä¸‰æ–¹åº“ä½¿ç”¨<code>getLogger(String)</code>ã€‚æ¯”å¦‚nettyã€‚</p>
<p>æ‰€éœ€éœ€è¦å¯¹å¸¦classLoaderå‚æ•°å’Œä¸å¸¦æ­¤å‚æ•°çš„<code>LoggerContext</code>éƒ½è¿›è¡Œæ›´æ–°ã€‚ä»£ç è§ä¸Šã€‚</p>
    </div>

    
    <div class="postFooter">
        <p>Posted by MingMoe.</p>
        <p>Last update Saturday, November 6, 2021.</p>
    </div>

</div>


        </main>
        
        
        


<aside class="mingSider">

    <p>æ¬¢è¿æ¥åˆ°æœ¬ç«™[]~ï¼ˆï¿£â–½ï¿£ï¼‰~*</p>

    
    <div>
        <iframe style="overflow: hidden;display: flex;width:100%" width="300" height="30" frameborder="0" scrolling="no" hspace="0" src="https://i.tianqi.com/index.php?c=code&id=34&icon=1"></iframe>
    </div>

    
    <div>
        <a class="twitter-timeline" data-lang="zh-cn" data-height="2048" href="https://twitter.com/ming_moe_?ref_src=twsrc%5Etfw"></a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    </div>

</aside>
    </div>

    
    

<footer class="mingFooter">

    <p>Powered by <a href="https://gohugo.io/">Hugo</a>.Copyright Â©  2021 MingMoe.<br>

    <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
        <img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br />æœ¬ä½œå“é‡‡ç”¨<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">
            çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®
        </a>è¿›è¡Œè®¸å¯ã€‚

    </p>

</footer>

</body>


</html>
